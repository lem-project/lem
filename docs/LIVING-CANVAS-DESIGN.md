# Living Canvas - è¨­è¨ˆæ›¸

Lemã‚¨ãƒ‡ã‚£ã‚¿ã®æ–°æ©Ÿèƒ½ã€ŒLiving Canvasã€ã®è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚

## æ¦‚è¦

Living Canvasã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’**é–¢æ•°ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã®ã‚°ãƒ©ãƒ•**ã¨ã—ã¦å¯è¦–åŒ–ã—ã€
**Figmaãƒ©ã‚¤ã‚¯ãªã‚­ãƒ£ãƒ³ãƒã‚¹**ä¸Šã§æ“ä½œã§ãã‚‹é©æ–°çš„ãªæ©Ÿèƒ½ã§ã™ã€‚

### ãƒ“ã‚¸ãƒ§ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Figma-like Canvas                                          â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ main     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ parse    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ validate â”‚    â”‚
â”‚   â”‚          â”‚         â”‚          â”‚        â”‚   âš¡å®Ÿè¡Œä¸­ â”‚    â”‚
â”‚   â”‚ [ğŸ“AI]   â”‚         â”‚ [ğŸ“AI]   â”‚        â”‚          â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”‚                                         â”‚          â”‚
â”‚        â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ log      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                       â”‚          â”‚                          â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                             â”‚
â”‚   [ä»˜ç®‹: "ã“ã®é–¢æ•°ã‚’ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãã§æ›¸ãç›´ã—ã¦"]      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ

| æ—¢å­˜ãƒ„ãƒ¼ãƒ« | Living Canvas |
|-----------|---------------|
| ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° â†’ ãƒ†ã‚­ã‚¹ãƒˆã®ä»£æ›¿ | ãƒ†ã‚­ã‚¹ãƒˆ**ã¨**ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã®èåˆ |
| é™çš„ã‚³ãƒ¼ãƒ«ã‚°ãƒ©ãƒ• | **å‹•çš„**å®Ÿè¡ŒçŠ¶æ…‹ã®å¯è¦–åŒ– |
| AIã¯ãƒãƒ£ãƒƒãƒˆã§åˆ†é›¢ | AIãŒ**ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã«çµ±åˆ** |
| ã‚³ãƒ¼ãƒ‰ç·¨é›†ã¯åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ | **åŒä¸€ã‚­ãƒ£ãƒ³ãƒã‚¹**ã§å…¨ã¦å®Œçµ |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„

**Living Canvasã¯ã€Œäººé–“ãŒã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã™ã‚‹ã€ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚**

### ã€Œç†è§£ã€ã®ãƒ¬ãƒ™ãƒ«éšå±¤

```
Level 0: æ§‹é€ ã®æŠŠæ¡ â† Phase 1 ã§é”æˆ
  â””â”€â”€ ã€Œã©ã‚“ãªé–¢æ•°ãŒã‚ã‚‹ã‹ã€ã€Œä½•ãŒä½•ã‚’å‘¼ã‚“ã§ã„ã‚‹ã‹ã€

Level 1: é–¢ä¿‚æ€§ã®ç†è§£ â† Phase 1.5/1.7 ã§é”æˆ
  â””â”€â”€ ã€Œãªãœã“ã®é–¢æ•°ãŒã“ã‚Œã‚’å‘¼ã¶ã®ã‹ã€ã€Œãƒ‡ãƒ¼ã‚¿ã¯ã©ã†æµã‚Œã‚‹ã‹ã€

Level 2: å‹•çš„æŒ™å‹•ã®ç†è§£ â† Phase 2 ã§é”æˆ
  â””â”€â”€ ã€Œå®Ÿè¡Œæ™‚ã«ä½•ãŒèµ·ãã‚‹ã‹ã€ã€Œã©ã®é †åºã§å‘¼ã°ã‚Œã‚‹ã‹ã€

Level 3: æ„å›³ã®ç†è§£ â† Phase 3 ã§é”æˆ
  â””â”€â”€ ã€Œãªãœã“ã†è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã‹ã€ã€Œã©ã“ã‚’å¤‰ãˆã‚‹ã¨ä½•ã«å½±éŸ¿ã™ã‚‹ã‹ã€
```

### ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | å¿…è¦ãªæƒ…å ± | å¯¾å¿œPhase |
|-------------|-----------|-----------|
| æ–°è¦å‚åŠ è€…ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | å…¨ä½“åƒã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | 1, 1.5 |
| ãƒã‚°è¿½è·¡ | ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€å®Ÿè¡Œãƒ‘ã‚¹ | 1.7, 2 |
| ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ | å¤‰æ›´ã®å½±éŸ¿ç¯„å›² | 1.5, 1.7 |
| ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”» | çµåˆåº¦ã€å¾ªç’°ä¾å­˜ | 1.5 |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æŸ» | ãƒ›ãƒƒãƒˆãƒ‘ã‚¹ã€å‘¼ã³å‡ºã—é »åº¦ | 2 |

---

## ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥è¨ˆç”»

### Phase 1: åŸºç›¤ï¼ˆã‚°ãƒ©ãƒ•å¯è¦–åŒ–ï¼‰âœ… å®Œäº†

**ç›®æ¨™**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°ã‚’ã‚°ãƒ©ãƒ•ã¨ã—ã¦è¡¨ç¤ºã—ã€åŸºæœ¬æ“ä½œã‚’å¯èƒ½ã«ã™ã‚‹

**æ©Ÿèƒ½**:
- é–¢æ•°ã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦è¡¨ç¤º âœ…
- é–¢æ•°å‘¼ã³å‡ºã—ã‚’ã‚¨ãƒƒã‚¸ã¨ã—ã¦è¡¨ç¤º âœ…
- ãƒãƒ¼ãƒ‰ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— âœ…
- ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ã«ã‚¸ãƒ£ãƒ³ãƒ— âœ…
- è‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆdagreï¼‰ âœ…

---

### Phase 1.5: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¢ç´¢å¼·åŒ– ğŸ†• ã€å®Ÿè£…ä¸­ã€‘

**ç›®æ¨™**: é™çš„ã‚°ãƒ©ãƒ•ã‚’èƒ½å‹•çš„ã«æ¢ç´¢ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

**ç†ç”±**: Phase 1 â†’ Phase 2 ã®ã‚®ãƒ£ãƒƒãƒ—ãŒå¤§ãã™ãã‚‹ã€‚ã€Œè¦‹ã‚‹ã ã‘ã€ã‹ã‚‰ã€Œæ¢ç´¢ã§ãã‚‹ã€ã¸ã®é€²åŒ–ãŒå¿…è¦ã€‚

**æ©Ÿèƒ½**:

| æ©Ÿèƒ½ | èª¬æ˜ | å„ªå…ˆåº¦ | é›£æ˜“åº¦ | çŠ¶æ…‹ |
|------|------|--------|--------|------|
| ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ« | å¼•æ•°ãƒªã‚¹ãƒˆã€æˆ»ã‚Šå€¤å‹ã€docstringã€ã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹è¡¨ç¤º | é«˜ | ä½ | âœ… å®Œäº† |
| ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºï¼†ãƒã‚¤ãƒ©ã‚¤ãƒˆ | é«˜ | ä¸­ | âœ… å®Œäº† |
| ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºå‹•çš„èª¿æ•´ | æ¥ç¶šæ•°ï¼ˆå‘¼ã³å‡ºã—å…ƒ+å‘¼ã³å‡ºã—å…ˆï¼‰ã«åŸºã¥ãã‚µã‚¤ã‚ºå¤‰æ›´ | é«˜ | ä½ | â¬š æœªå®Ÿè£… |
| å‘¼ã³å‡ºã—æ–¹å‘åˆ¥ã‚¨ãƒƒã‚¸è‰²åˆ†ã‘ | callerï¼ˆé’ï¼‰/ calleeï¼ˆç·‘ï¼‰ã®è¦–è¦šçš„åŒºåˆ¥ | é«˜ | ä½ | â¬š æœªå®Ÿè£… |
| ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° | function / macro / generic-function ã®é¸æŠçš„è¡¨ç¤º | é«˜ | ä½-ä¸­ | â¬š æœªå®Ÿè£… |
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° | å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°ã‚’è¡¨ç¤º/éè¡¨ç¤º | ä¸­ | ä½ | â¬š æœªå®Ÿè£… |
| ãƒ‘ã‚¹æ¤œç´¢ | 2ã¤ã®ãƒãƒ¼ãƒ‰é–“ã®å‘¼ã³å‡ºã—ãƒ‘ã‚¹ã‚’è¡¨ç¤º | ä¸­ | ä¸­ | â¬š æœªå®Ÿè£… |
| å¾ªç’°ä¾å­˜ã®æ¤œå‡º | å¾ªç’°å‚ç…§ã‚’ã‚¨ãƒ©ãƒ¼è‰²ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ | ä¸­ | ä¸­ | â¬š æœªå®Ÿè£… |
| ãƒŸãƒ‹ãƒãƒƒãƒ— | å¤§è¦æ¨¡ã‚°ãƒ©ãƒ•ã§ã®å…¨ä½“åƒæŠŠæ¡ | ä½ | ä¸­ | â¬š æœªå®Ÿè£… |

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `canvas-buffer.lisp` (JavaScriptè¿½åŠ )ã€`commands.lisp` (ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚³ãƒãƒ³ãƒ‰)

**å®Ÿè£…è©³ç´°ï¼ˆå®Œäº†åˆ†ï¼‰**:

1. **ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ«** (2025-12-14)
   - å¼•æ•°ãƒªã‚¹ãƒˆï¼ˆarglistï¼‰ã®è¡¨ç¤º
   - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«:è¡Œç•ªå·ã®è¡¨ç¤º
   - caller/callee ã®æ¥ç¶šæ•°è¡¨ç¤º
   - docstring ã®è¡¨ç¤º
   - å®Ÿè£…: `call-graph.lisp` ã« `format-arglist-for-display` è¿½åŠ ã€`canvas-buffer.lisp` ã® JavaScript ã‚’æ‹¡å¼µ

2. **ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼** (2025-12-14)
   - ãƒãƒ¼ãƒ‰ã‚·ãƒ³ã‚°ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `pop-to-buffer` ã§è¡¨ç¤º
   - å¯¾å¿œã™ã‚‹é–¢æ•°ï¼ˆdefunï¼‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
   - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã¯Canvasã«ç¶­æŒ
   - åˆ¥æ“ä½œæ™‚ã« `*pre-command-hook*` ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è‡ªå‹•ã‚¯ãƒªã‚¢
   - å®Ÿè£…: `commands.lisp` ã« `show-node-source-popup`, `highlight-sexp-at-point`, `clear-highlight-overlay` è¿½åŠ 

---

### Phase 1.7: ã‚³ãƒ¼ãƒ‰ã¨ã®é€£æºå¼·åŒ– ğŸ†•

**ç›®æ¨™**: ã‚°ãƒ©ãƒ•ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªé€£æº

**ç†ç”±**: ã€Œãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã®èåˆã€ã¨ã„ã†å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã‚’æ—©æœŸã«å®Ÿç¾

**æ©Ÿèƒ½**:

| æ©Ÿèƒ½ | èª¬æ˜ | å„ªå…ˆåº¦ | é›£æ˜“åº¦ | çŠ¶æ…‹ |
|------|------|--------|--------|------|
| ãƒãƒ¼ãƒ‰ãƒ›ãƒãƒ¼æ™‚ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ | é–¢æ•°æœ¬ä½“ã®æœ€åˆã®æ•°è¡Œã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º | é«˜ | ä¸­ | â¬š æœªå®Ÿè£… |
| ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®åŒæœŸ | ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®é–¢æ•°ã‚’ã‚°ãƒ©ãƒ•ä¸Šã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ | é«˜ | ä¸­ | â¬š æœªå®Ÿè£… |
| Split view | ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ä¸¦åˆ—è¡¨ç¤º | ä¸­ | ä¸­-é«˜ | â¬š æœªå®Ÿè£… |
| ã‚°ãƒ©ãƒ•å†…æ¤œç´¢ | ãƒãƒ¼ãƒ‰åã®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œç´¢ | ä¸­ | ä½ | âœ… å®Œäº†ï¼ˆPhase 1ã§å®Ÿè£…æ¸ˆã¿ï¼‰|
| ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ | PNG/SVGå‡ºåŠ›ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨é€”ï¼‰ | ä½ | ä½ | â¬š æœªå®Ÿè£… |

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `canvas-buffer.lisp`ã€`commands.lisp`

---

### Phase 2: å®Ÿè¡Œå¯è¦–åŒ–ï¼ˆç°¡æ˜“ç‰ˆï¼‰

**ç›®æ¨™**: ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒçŠ¶æ…‹ã‚’å¯è¦–åŒ–ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¸®å°ï¼‰

**å¤‰æ›´ç‚¹**: å½“åˆè¨ˆç”»ã‹ã‚‰ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¸®å°ã—ã€åŸºæœ¬çš„ãªæ©Ÿèƒ½ã«é›†ä¸­

**æ©Ÿèƒ½**:
- åŸºæœ¬çš„ãªtraceå¯è¦–åŒ–ï¼ˆå‘¼ã³å‡ºã—å±¥æ­´ã®ãƒªãƒ—ãƒ¬ã‚¤ï¼‰
- å‘¼ã³å‡ºã—å›æ•°ã®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
- å®Ÿè¡Œä¸­ã®é–¢æ•°ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- ~~ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¿½è·¡~~ â†’ å°†æ¥æ‹¡å¼µã¸
- ~~å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®è©³ç´°è¡¨ç¤º~~ â†’ å°†æ¥æ‹¡å¼µã¸

**ä¾å­˜**: Phase 1.5, 1.7 ã®å®Œäº†

---

### Phase 2.5: SLDBçµ±åˆã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ â†’ **å»¶æœŸ**

**ç†ç”±**:
- ã€Œã‚³ãƒ¼ãƒ‰ç†è§£ã€ã¨ã„ã†ç›®çš„ã«å¯¾ã—ã¦ã¯ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ã¯å„ªå…ˆåº¦ãŒä½ã„
- æŠ€è¡“çš„è¤‡é›‘åº¦ãŒéå¸¸ã«é«˜ã„
- åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã‚’æ¨å¥¨

**ç¾çŠ¶**: è¨­è¨ˆæ›¸ã¯ç¶­æŒã™ã‚‹ãŒã€Phase 3 å®Œäº†å¾Œã«å†è©•ä¾¡

---

### Phase 3: AIçµ±åˆ

**ç›®æ¨™**: ä»˜ç®‹ã‚’é€šã˜ã¦AIã¨é€£æºã—ã€ã‚³ãƒ¼ãƒ‰ç†è§£ã‚’æ”¯æ´

**æ©Ÿèƒ½**:
- ãƒãƒ¼ãƒ‰ã«ä»˜ç®‹ã‚’è¿½åŠ 
- ã€Œã“ã®é–¢æ•°ã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã‹èª¬æ˜ã—ã¦ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- AIã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰èª¬æ˜ç”Ÿæˆ
- ä¾å­˜é–¢ä¿‚ã®è³ªå•å¿œç­”
- ~~ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»é©ç”¨~~ â†’ å°†æ¥æ‹¡å¼µã¸

---

### Phase 4: æ™‚é–“è»¸ç·¨é›† â†’ **å»¶æœŸ**

**ç†ç”±**:
- ç ”ç©¶ãƒ¬ãƒ™ãƒ«ã®æ©Ÿèƒ½ã§ã‚ã‚Šã€å®Ÿç”¨æ€§ãŒæœªæ¤œè¨¼
- ã‚¹ã‚³ãƒ¼ãƒ—ã‚¯ãƒªãƒ¼ãƒ—ã®ãƒªã‚¹ã‚¯ãŒéå¸¸ã«é«˜ã„

**ç¾çŠ¶**: å°†æ¥ã®ç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ†é›¢

---

## Quick Win ãƒªã‚¹ãƒˆï¼ˆå³åº§ã«ä¾¡å€¤ã‚’æä¾›ã§ãã‚‹æ©Ÿèƒ½ï¼‰

### ğŸ”¥ æœ€å„ªå…ˆï¼ˆPhase 1.5 å‰åŠï¼‰

```
âœ… ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ«ã®å……å®Ÿ (2025-12-14 å®Œäº†)
  - å¼•æ•°ãƒªã‚¹ãƒˆè¡¨ç¤º âœ…
  - docstringè¡¨ç¤º âœ…
  - ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¡¨ç¤º âœ…
  - æ¥ç¶šæ•°ï¼ˆcaller/calleeï¼‰è¡¨ç¤º âœ…

âœ… ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ (2025-12-14 å®Œäº†)
  - ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã§ã‚½ãƒ¼ã‚¹ã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º âœ…
  - å¯¾è±¡é–¢æ•°ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º âœ…
  - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç¶­æŒï¼†è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— âœ…

â–¡ ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®å‹•çš„èª¿æ•´
  - æ¥ç¶šæ•°ï¼ˆin + out degreeï¼‰ã«åŸºã¥ãã‚µã‚¤ã‚ºå¤‰æ›´
  - ã€Œãƒãƒ–ã€ã¨ãªã‚‹é‡è¦é–¢æ•°ã‚’è¦–è¦šçš„ã«å¼·èª¿

â–¡ å‘¼ã³å‡ºã—æ–¹å‘åˆ¥ã®ã‚¨ãƒƒã‚¸è‰²åˆ†ã‘
  - å‘¼ã³å‡ºã—å…ƒã¸ã®çŸ¢å°ï¼ˆé’ç³»ï¼‰
  - å‘¼ã³å‡ºã—å…ˆã¸ã®çŸ¢å°ï¼ˆç·‘ç³»ï¼‰

â–¡ ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°UI
  - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¡¨ç¤º/éè¡¨ç¤º
  - function / macro / generic-function
```

### âš¡ é«˜å„ªå…ˆï¼ˆPhase 1.5 å¾ŒåŠï¼‰

```
â–¡ ãƒ‘ã‚¹æ¤œç´¢æ©Ÿèƒ½
  - 2ã¤ã®ãƒãƒ¼ãƒ‰é–“ã®å‘¼ã³å‡ºã—ãƒ‘ã‚¹ã‚’è¡¨ç¤º
  - BFS/DFSã§æœ€çŸ­ãƒ‘ã‚¹ã‚’è¨ˆç®—

â–¡ å¾ªç’°ä¾å­˜ã®æ¤œå‡ºã¨è¡¨ç¤º
  - å¾ªç’°å‚ç…§ã‚’ã‚¨ãƒ©ãƒ¼è‰²ï¼ˆèµ¤ï¼‰ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»ã«æœ‰ç”¨

âœ… ã‚°ãƒ©ãƒ•å†…æ¤œç´¢ (Phase 1ã§å®Ÿè£…æ¸ˆã¿)
  - ãƒãƒ¼ãƒ‰åã®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œç´¢ âœ…
  - æ¤œç´¢çµæœã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ âœ…
```

### ğŸ’¡ ä¸­å„ªå…ˆï¼ˆPhase 1.7ï¼‰

```
â–¡ ãƒãƒ¼ãƒ‰ãƒ›ãƒãƒ¼æ™‚ã®ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆè¡¨ç¤º
  - é–¢æ•°æœ¬ä½“ã®æœ€åˆã®5-10è¡Œã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º

â–¡ ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®åŒæœŸ
  - ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®é–¢æ•°ã‚’ã‚°ãƒ©ãƒ•ä¸Šã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ

â–¡ Split viewå®Ÿè£…
  - ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ä¸¦åˆ—è¡¨ç¤º
```

---

## å®Ÿè£…å„ªå…ˆé †ä½ã¾ã¨ã‚

```
Phase 1 âœ… å®Œäº†
    â”‚
    â–¼
Phase 1.5 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¢ç´¢å¼·åŒ– â† ã€å®Ÿè£…ä¸­ã€‘
â”œâ”€â”€ [1] ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ« âœ… å®Œäº†
â”œâ”€â”€ [2] ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ âœ… å®Œäº†
â”œâ”€â”€ [3] ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºå‹•çš„èª¿æ•´
â”œâ”€â”€ [4] ã‚¨ãƒƒã‚¸è‰²åˆ†ã‘
â”œâ”€â”€ [5] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°UI
â”œâ”€â”€ [6] ãƒ‘ã‚¹æ¤œç´¢
â””â”€â”€ [7] å¾ªç’°ä¾å­˜æ¤œå‡º
    â”‚
    â–¼
Phase 1.7 ã‚³ãƒ¼ãƒ‰é€£æºå¼·åŒ–
â”œâ”€â”€ [8] ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆè¡¨ç¤º
â”œâ”€â”€ [9] ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®åŒæœŸ
â””â”€â”€ [10] Split view
    â”‚
    â–¼
Phase 2 å®Ÿè¡Œå¯è¦–åŒ–ï¼ˆç°¡æ˜“ç‰ˆï¼‰
â”œâ”€â”€ [11] åŸºæœ¬traceå¯è¦–åŒ–
â””â”€â”€ [12] ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
    â”‚
    â–¼
Phase 3 AIçµ±åˆ
â”œâ”€â”€ [13] ä»˜ç®‹ã‚·ã‚¹ãƒ†ãƒ 
â””â”€â”€ [14] AIèª¬æ˜ç”Ÿæˆ
    â”‚
    â–¼
Phase 2.5/4 ï¼ˆå»¶æœŸï¼‰
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Living Canvas                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     WebView Frontend (HTML/CSS/JS)              â”‚   â”‚
â”‚  â”‚     - Cytoscape.js for graph rendering          â”‚   â”‚
â”‚  â”‚     - ãƒãƒ¼ãƒ‰æç”»ã€ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—                â”‚   â”‚
â”‚  â”‚     - å®Ÿè¡ŒçŠ¶æ…‹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†• JSON-RPC                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Lem Core (Common Lisp)                  â”‚   â”‚
â”‚  â”‚     - ãƒãƒƒãƒ•ã‚¡/ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†                     â”‚   â”‚
â”‚  â”‚     - Lispè©•ä¾¡ã‚¨ãƒ³ã‚¸ãƒ³                           â”‚   â”‚
â”‚  â”‚     - ã‚³ãƒ¼ãƒ«ã‚°ãƒ©ãƒ•è§£æ                            â”‚   â”‚
â”‚  â”‚     - AI APIçµ±åˆ                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¢å­˜æ©Ÿèƒ½ã®æ´»ç”¨

| æ—¢å­˜æ©Ÿèƒ½ | ç”¨é€” |
|---------|------|
| `html-buffer` | Canvasè¡¨ç¤ºã®ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ |
| `change-view-to-html` | Viewã‚’HTMLãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿ |
| `js-eval` | Lispâ†’JSé€šä¿¡ï¼ˆã‚°ãƒ©ãƒ•æ›´æ–°ç­‰ï¼‰ |
| `register-method` | JSâ†’Lispé€šä¿¡ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ï¼‰ |

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
extensions/
â””â”€â”€ living-canvas/
    â”œâ”€â”€ lem-living-canvas.asd       # ã‚·ã‚¹ãƒ†ãƒ å®šç¾©         âœ… å®Ÿè£…æ¸ˆ
    â”œâ”€â”€ package.lisp                # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å®šç¾©       âœ… å®Ÿè£…æ¸ˆ
    â”œâ”€â”€ call-graph.lisp             # é–¢æ•°å‘¼ã³å‡ºã—ã‚°ãƒ©ãƒ•è§£æ âœ… å®Ÿè£…æ¸ˆ
    â”œâ”€â”€ canvas-buffer.lisp          # Canvasãƒãƒƒãƒ•ã‚¡ã‚¯ãƒ©ã‚¹  âœ… å®Ÿè£…æ¸ˆ
    â”œâ”€â”€ commands.lisp               # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒãƒ³ãƒ‰      âœ… å®Ÿè£…æ¸ˆ
    â”œâ”€â”€ trace.lisp                  # å®Ÿè¡Œè¿½è·¡ (Phase 2)   â¬š æœªä½œæˆ
    â””â”€â”€ debugger.lisp               # SLDBçµ±åˆ (Phase 2.5) â¬š æœªä½œæˆ
```

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### Lispå´

```lisp
;; ãƒãƒ¼ãƒ‰ã®è¡¨ç¾
(defstruct graph-node
  id              ; ãƒ¦ãƒ‹ãƒ¼ã‚¯ID (ã‚·ãƒ³ãƒœãƒ«å + ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸)
  name            ; é–¢æ•°å
  package         ; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å
  type            ; :function, :macro, :generic-function
  docstring       ; ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ–‡å­—åˆ—
  source-location ; (file . line-number)
  position)       ; (x . y) ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã®ä½ç½®

;; ã‚¨ãƒƒã‚¸ã®è¡¨ç¾
(defstruct graph-edge
  source          ; å‘¼ã³å‡ºã—å…ƒãƒãƒ¼ãƒ‰ID
  target          ; å‘¼ã³å‡ºã—å…ˆãƒãƒ¼ãƒ‰ID
  call-type)      ; :direct, :funcall, :apply

;; ã‚°ãƒ©ãƒ•å…¨ä½“
(defstruct call-graph
  nodes           ; ãƒãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«
  edges           ; ã‚¨ãƒƒã‚¸ã®ãƒªã‚¹ãƒˆ
  root-package)   ; è§£æå¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```

### JSON-RPC API

#### Lisp â†’ JavaScript

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|---------|------|-----------|
| `canvas:init` | ã‚­ãƒ£ãƒ³ãƒã‚¹åˆæœŸåŒ– | `{width, height, theme}` |
| `canvas:update-graph` | ã‚°ãƒ©ãƒ•æ›´æ–° | `{nodes, edges}` |
| `canvas:highlight-node` | ãƒãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ | `{nodeId, color}` |
| `canvas:set-node-position` | ãƒãƒ¼ãƒ‰ä½ç½®è¨­å®š | `{nodeId, x, y}` |

#### JavaScript â†’ Lisp

| ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|---------|------|-----------|
| `canvas:node-clicked` | ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ | `{nodeId}` |
| `canvas:node-moved` | ãƒãƒ¼ãƒ‰ç§»å‹•å®Œäº† | `{nodeId, x, y}` |
| `canvas:request-refresh` | ã‚°ãƒ©ãƒ•å†è¨ˆç®—è¦æ±‚ | `{packageName}` |
| `canvas:open-source` | ã‚½ãƒ¼ã‚¹è¡¨ç¤ºè¦æ±‚ | `{nodeId}` |

---

## Phase 1 è©³ç´°å®Ÿè£…

### call-graph.lisp

```lisp
(defpackage :lem-living-canvas/call-graph
  (:use :cl)
  (:export #:analyze-package
           #:analyze-buffer
           #:get-callees
           #:graph-to-json))
(in-package :lem-living-canvas/call-graph)

;; é–¢æ•°æœ¬ä½“ã‹ã‚‰ã‚·ãƒ³ãƒœãƒ«å‚ç…§ã‚’æŠ½å‡º
(defun extract-called-functions (form)
  "ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã‚’æŠ½å‡ºã™ã‚‹"
  (let ((calls '()))
    (labels ((walk (form)
               (cond
                 ((symbolp form)
                  (when (fboundp form)
                    (pushnew form calls)))
                 ((consp form)
                  (case (car form)
                    ((function)
                     (when (symbolp (cadr form))
                       (pushnew (cadr form) calls)))
                    ((funcall apply)
                     (when (and (consp (cadr form))
                                (eq 'function (caadr form)))
                       (pushnew (cadadr form) calls)))
                    (otherwise
                     (mapc #'walk form)))))))
      (walk form))
    calls))

;; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®å…¨é–¢æ•°ã‚’è§£æ
(defun analyze-package (package-designator)
  "æŒ‡å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°å‘¼ã³å‡ºã—ã‚°ãƒ©ãƒ•ã‚’æ§‹ç¯‰ã™ã‚‹"
  (let ((package (find-package package-designator))
        (nodes (make-hash-table :test 'eq))
        (edges '()))
    (do-symbols (sym package)
      (when (and (fboundp sym)
                 (eq (symbol-package sym) package))
        ;; ãƒãƒ¼ãƒ‰ä½œæˆ
        (setf (gethash sym nodes)
              (make-graph-node
               :id (format nil "~A:~A"
                           (package-name package)
                           (symbol-name sym))
               :name (symbol-name sym)
               :package (package-name package)
               :type (cond ((macro-function sym) :macro)
                           ((typep (fdefinition sym) 'generic-function)
                            :generic-function)
                           (t :function))
               :docstring (documentation sym 'function)
               :source-location (get-source-location sym)))
        ;; ã‚¨ãƒƒã‚¸ä½œæˆ
        (let ((callees (get-callees sym)))
          (dolist (callee callees)
            (when (gethash callee nodes)
              (push (make-graph-edge
                     :source sym
                     :target callee
                     :call-type :direct)
                    edges))))))
    (make-call-graph :nodes nodes :edges edges :root-package package)))
```

### canvas-buffer.lisp

```lisp
(defpackage :lem-living-canvas/buffer
  (:use :cl :lem)
  (:export #:canvas-buffer
           #:make-canvas-buffer
           #:canvas-buffer-graph
           #:canvas-buffer-source-buffer
           #:update-canvas))
(in-package :lem-living-canvas/buffer)

(defclass canvas-buffer (html-buffer)
  ((graph :initarg :graph
          :accessor canvas-buffer-graph
          :documentation "ã‚³ãƒ¼ãƒ«ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿")
   (source-buffer :initarg :source-buffer
                  :accessor canvas-buffer-source-buffer
                  :documentation "è§£æå¯¾è±¡ã®ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡")
   (node-positions :initform (make-hash-table :test 'equal)
                   :accessor canvas-buffer-node-positions
                   :documentation "ãƒãƒ¼ãƒ‰ä½ç½®ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥")))

(defun make-canvas-buffer (name source-buffer graph)
  "Canvasãƒãƒƒãƒ•ã‚¡ã‚’ä½œæˆã™ã‚‹"
  (let ((buffer (make-buffer name)))
    (change-class buffer 'canvas-buffer
                  :graph graph
                  :source-buffer source-buffer
                  :html (generate-canvas-html graph))
    buffer))
```

### commands.lisp

```lisp
(defpackage :lem-living-canvas/commands
  (:use :cl :lem)
  (:export #:living-canvas
           #:living-canvas-refresh
           #:living-canvas-jump-to-source))
(in-package :lem-living-canvas/commands)

;; JSâ†’Lisp ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™»éŒ²
(lem-server:register-method "canvas:node-selected"
  (lambda (args)
    (let ((node-id (gethash "nodeId" args)))
      (message "Selected: ~A" node-id))))

(lem-server:register-method "canvas:open-source"
  (lambda (args)
    (let ((node-id (gethash "nodeId" args)))
      (lem:send-event
       (lambda ()
         (jump-to-node-source node-id))))))

(lem-server:register-method "canvas:node-moved"
  (lambda (args)
    (let ((node-id (gethash "nodeId" args))
          (x (gethash "x" args))
          (y (gethash "y" args)))
      (save-node-position node-id x y))))

;; ãƒ¡ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰
(define-command living-canvas (package-name) ((:string "Package: "))
  "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°å‘¼ã³å‡ºã—ã‚°ãƒ©ãƒ•ã‚’Canvasã§è¡¨ç¤º"
  (let* ((source-buffer (current-buffer))
         (graph (analyze-package package-name))
         (canvas-buffer (make-canvas-buffer
                         (format nil "*Canvas: ~A*" package-name)
                         source-buffer
                         graph)))
    (pop-to-buffer canvas-buffer)))

(define-command living-canvas-current-buffer () ()
  "ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡ã®é–¢æ•°ã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤º"
  (let* ((buffer (current-buffer))
         (package (or (buffer-package buffer) *package*)))
    (living-canvas (package-name package))))

(define-command living-canvas-refresh () ()
  "Canvasã‚’æ›´æ–°"
  (when (typep (current-buffer) 'canvas-buffer)
    (let* ((buffer (current-buffer))
           (source-buffer (canvas-buffer-source-buffer buffer))
           (graph (analyze-buffer source-buffer)))
      (setf (canvas-buffer-graph buffer) graph)
      (js-eval (current-window)
               (format nil "updateGraph(~A)"
                       (graph-to-cytoscape-json graph))))))
```

---

## JavaScriptå´å®Ÿè£…

### Canvas Surface (Cytoscape.js)

```javascript
// canvas-surface.js
const cy = cytoscape({
  container: document.getElementById('cy'),
  style: [
    {
      selector: 'node',
      style: {
        'background-color': '#3c3c3c',
        'border-color': '#5a5a5a',
        'border-width': 2,
        'label': 'data(name)',
        'color': '#d4d4d4',
        'text-valign': 'center',
        'text-halign': 'center',
        'font-size': '11px',
        'font-family': 'Consolas, monospace',
        'width': 'label',
        'height': 32,
        'padding': '12px',
        'shape': 'roundrectangle'
      }
    },
    {
      selector: 'node[type="macro"]',
      style: { 'border-color': '#c586c0' }
    },
    {
      selector: 'node[type="generic-function"]',
      style: { 'border-color': '#4ec9b0' }
    },
    {
      selector: 'edge',
      style: {
        'width': 1.5,
        'line-color': '#454545',
        'target-arrow-color': '#454545',
        'target-arrow-shape': 'triangle',
        'curve-style': 'bezier'
      }
    },
    {
      selector: 'node:selected',
      style: {
        'border-color': '#007acc',
        'border-width': 3,
        'background-color': '#264f78'
      }
    },
    {
      selector: '.executing',
      style: {
        'background-color': '#4a9eff',
        'border-color': '#2d7ad9'
      }
    }
  ],
  layout: {
    name: 'dagre',
    rankDir: 'LR',
    nodeSep: 50,
    rankSep: 80
  }
});

// ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
cy.on('tap', 'node', (e) => {
  invokeLem('canvas:node-selected', { nodeId: e.target.id() });
});

cy.on('dbltap', 'node', (e) => {
  invokeLem('canvas:open-source', { nodeId: e.target.id() });
});

cy.on('dragfree', 'node', (e) => {
  const pos = e.target.position();
  invokeLem('canvas:node-moved', {
    nodeId: e.target.id(),
    x: pos.x,
    y: pos.y
  });
});

// Lispå´ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°
window.updateGraph = (data) => {
  cy.json({ elements: data.elements });
  cy.layout({ name: 'dagre', rankDir: 'LR' }).run();
};

window.highlightNode = (nodeId) => {
  cy.$('.executing').removeClass('executing');
  cy.$('#' + nodeId).addClass('executing');
};
```

---

## å®Ÿè£…é †åº

### Phase 1 å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```
Week 1: åŸºç›¤
â”œâ”€â”€ [1] call-graph.lisp - é–¢æ•°æŠ½å‡ºã¨ä¾å­˜è§£æ
â”œâ”€â”€ [2] package.lisp + .asd - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
â””â”€â”€ [3] åŸºæœ¬çš„ãªJSONå‡ºåŠ›

Week 2: è¡¨ç¤º
â”œâ”€â”€ [4] canvas-surface.js - Cytoscapeçµ±åˆ
â”œâ”€â”€ [5] canvas-mode.lisp - ãƒ¢ãƒ¼ãƒ‰å®šç¾©
â””â”€â”€ [6] HTMLç”Ÿæˆã¨WebViewçµ±åˆ

Week 3: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
â”œâ”€â”€ [7] ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚½ãƒ¼ã‚¹ã‚¸ãƒ£ãƒ³ãƒ—
â”œâ”€â”€ [8] ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
â””â”€â”€ [9] ä½ç½®ã®æ°¸ç¶šåŒ–

Week 4: ä»•ä¸Šã’
â”œâ”€â”€ [10] ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´
â”œâ”€â”€ [11] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â””â”€â”€ [12] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

---

## Phase 2 è©³ç´°å®Ÿè£…

### æ¦‚è¦

Phase 2ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒçŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§Canvasã«å¯è¦–åŒ–ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Living Canvas with Execution Visualization                 â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  42ms   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  15ms   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ main     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ parse    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ validate â”‚   â”‚
â”‚   â”‚  Ã—3      â”‚         â”‚  Ã—12     â”‚         â”‚  âš¡å®Ÿè¡Œä¸­  â”‚   â”‚
â”‚   â”‚ ğŸŸ¢       â”‚         â”‚ ğŸŸ¡       â”‚         â”‚ ğŸ”´       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                    â”‚
â”‚   [Stats: 27 calls | 156ms total | 3 errors]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 2 Architecture                     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     WebView Canvas (JavaScript)                      â”‚   â”‚
â”‚  â”‚     - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒã‚¤ãƒ©ã‚¤ãƒˆ                          â”‚   â”‚
â”‚  â”‚     - ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—è¡¨ç¤º                                â”‚   â”‚
â”‚  â”‚     - çµ±è¨ˆãƒ‘ãƒãƒ«                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†‘ js-eval                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         trace.lisp                                   â”‚   â”‚
â”‚  â”‚     - execution-tracker ã‚¯ãƒ©ã‚¹                       â”‚   â”‚
â”‚  â”‚     - Canvasé€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯                             â”‚   â”‚
â”‚  â”‚     - çµ±è¨ˆåé›†                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†‘ event-hooks                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     message-dispatcher (*event-hooks*)               â”‚   â”‚
â”‚  â”‚     - traceå‡ºåŠ›ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ                       â”‚   â”‚
â”‚  â”‚     - :write-string ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç›£è¦–                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
extensions/living-canvas/
â”œâ”€â”€ lem-living-canvas.asd   âœ… å®Ÿè£…æ¸ˆ
â”œâ”€â”€ package.lisp            âœ… å®Ÿè£…æ¸ˆ
â”œâ”€â”€ call-graph.lisp         âœ… å®Ÿè£…æ¸ˆ
â”œâ”€â”€ canvas-buffer.lisp      âœ… å®Ÿè£…æ¸ˆ (Phase 2ç”¨JavaScriptè¿½åŠ ãŒå¿…è¦)
â”œâ”€â”€ trace.lisp              â¬š æœªä½œæˆã€Phase 2ã€‘å®Ÿè¡Œè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ debugger.lisp           â¬š æœªä½œæˆã€Phase 2.5ã€‘SLDBçµ±åˆãƒ‡ãƒãƒƒã‚°
â””â”€â”€ commands.lisp           âœ… å®Ÿè£…æ¸ˆ (Phase 2/2.5 ã‚³ãƒãƒ³ãƒ‰è¿½åŠ ãŒå¿…è¦)
```

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```lisp
;; å®Ÿè¡Œã‚¤ãƒ™ãƒ³ãƒˆ
(defstruct execution-event
  node-id           ; é–¢æ•°ã®ãƒãƒ¼ãƒ‰ID
  event-type        ; :enter, :exit, :error
  timestamp         ; å†…éƒ¨æ™‚é–“
  depth             ; å‘¼ã³å‡ºã—æ·±åº¦
  duration-ms)      ; å®Ÿè¡Œæ™‚é–“ï¼ˆ:exitæ™‚ï¼‰

;; é–¢æ•°çµ±è¨ˆ
(defstruct function-stats
  node-id
  call-count        ; å‘¼ã³å‡ºã—å›æ•°
  total-time-ms     ; åˆè¨ˆå®Ÿè¡Œæ™‚é–“
  max-time-ms       ; æœ€å¤§å®Ÿè¡Œæ™‚é–“
  min-time-ms       ; æœ€å°å®Ÿè¡Œæ™‚é–“
  error-count)      ; ã‚¨ãƒ©ãƒ¼å›æ•°

;; å®Ÿè¡Œè¿½è·¡å™¨
(defclass execution-tracker ()
  ((canvas-buffer :accessor tracker-canvas-buffer)
   (target-package :accessor tracker-target-package)
   (active-p :accessor tracker-active-p)
   (stats :accessor tracker-stats)
   (event-history :accessor tracker-event-history)
   (call-stack :accessor tracker-call-stack)))
```

### ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|------|------|
| `living-canvas-toggle-trace` | `t` | è¿½è·¡ã®ON/OFFåˆ‡ã‚Šæ›¿ãˆ |
| `living-canvas-trace-all` | `T` | å…¨é–¢æ•°ã‚’trace |
| `living-canvas-untrace-all` | `U` | å…¨é–¢æ•°ã‚’untrace |
| `living-canvas-show-stats` | `s` | çµ±è¨ˆã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º |
| `living-canvas-clear-stats` | `C` | çµ±è¨ˆã‚’ã‚¯ãƒªã‚¢ |
| `living-canvas-update-heatmap` | `h` | ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—æ›´æ–° |
| `living-canvas-step-mode` | `S` | ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ |
| `living-canvas-step-next` | `n` | æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã¸é€²ã‚€ |
| `living-canvas-continue` | `c` | æ®‹ã‚Šå…¨ã¦ã‚’å®Ÿè¡Œ |

### JavaScript API

```javascript
// è¿½è·¡åˆæœŸåŒ–
window.initializeTracking()

// è¿½è·¡åœæ­¢
window.stopTracking()

// ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆãƒãƒƒãƒï¼‰
window.handleExecutionEvents([
  { nodeId: "PKG:FUNC", type: "enter", depth: 0 },
  { nodeId: "PKG:FUNC", type: "exit", durationMs: 42.5 }
])

// çµ±è¨ˆæ›´æ–°ï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ç”¨ï¼‰
window.updateStats({
  "PKG:FUNC": { callCount: 10, totalTimeMs: 150.5, errorCount: 0 }
})
```

### å®Ÿè£…çŠ¶æ…‹ (2025-12-14æ›´æ–°)

**Phase 2: å®Ÿè¡Œå¯è¦–åŒ–**
- [ ] trace.lispä½œæˆ - å®Ÿè¡Œè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ â† **æœ€å„ªå…ˆ**
- [ ] execution-trackerã‚¯ãƒ©ã‚¹å®šç¾©
- [ ] trace/untraceãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°
- [ ] traceå‡ºåŠ›ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆSBCLå½¢å¼ï¼‰
- [ ] Canvasé€šçŸ¥ï¼ˆjs-evalé€£æºï¼‰
- [ ] çµ±è¨ˆåé›†æ©Ÿæ§‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
- [ ] JavaScriptå®Ÿè¡Œå¯è¦–åŒ–UIï¼ˆ.executingã‚¯ãƒ©ã‚¹ã¯ç”¨æ„æ¸ˆã¿ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰
- [ ] å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®è¡¨ç¤ºï¼ˆå°†æ¥æ‹¡å¼µï¼‰

**Phase 2.5: SLDBçµ±åˆã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ**
- [ ] debugger.lispä½œæˆ
- [ ] ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®šUI
- [ ] :debugãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒƒã‚¯ï¼ˆsldb-setupã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰
- [ ] step/continue ã‚³ãƒãƒ³ãƒ‰
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ»åœæ­¢ä½ç½®è¡¨ç¤º

---

## Phase 2.5: SLDBçµ±åˆã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ

### æ¦‚è¦

microsã®SLDBï¼ˆãƒ‡ãƒãƒƒã‚¬ï¼‰æ©Ÿèƒ½ã¨çµ±åˆã—ã€æœ¬æ ¼çš„ãªã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚’å®Ÿç¾ã™ã‚‹ã€‚
å‰¯ä½œç”¨ã‚’å«ã‚€å®Ÿéš›ã®å®Ÿè¡Œã‚’ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«åˆ¶å¾¡ã§ãã‚‹ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Step Execution Flow                       â”‚
â”‚                                                              â”‚
â”‚   Living Canvas                    micros Server             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ ãƒãƒ¼ãƒ‰é¸æŠ â”‚ â”€â”€breakpointâ”€â”€â”€â–¶ â”‚sldb-breakâ”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚        â–²                               â”‚                     â”‚
â”‚        â”‚                          å®Ÿè¡Œé–‹å§‹                    â”‚
â”‚        â”‚                               â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    :debug         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ åœæ­¢è¡¨ç¤º  â”‚ â—€â”€â”€â”€messageâ”€â”€â”€â”€â”€â”€ â”‚ ãƒ–ãƒ¬ãƒ¼ã‚¯  â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚        â”‚                               â–²                     â”‚
â”‚        â”‚ n=step                        â”‚                     â”‚
â”‚        â”‚ c=continue                    â”‚                     â”‚
â”‚        â–¼                               â”‚                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    sldb-step      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ æ¬¡ã¸é€²ã‚€  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ å†é–‹     â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿè£…è¨ˆç”»

#### Step 1: ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†

```lisp
;; ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®š
(defun canvas-set-breakpoint (node-id)
  "ãƒãƒ¼ãƒ‰ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®š"
  (lisp-eval `(micros:sldb-break ,(node-id-to-symbol node-id))))

;; ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¡¨ç¤º
(defun update-breakpoint-visual (node-id active-p)
  (js-eval window
    (format nil "setBreakpoint('~A', ~A)" node-id (if active-p "true" "false"))))
```

#### Step 2: :debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒƒã‚¯

```lisp
;; sldb.lisp ã® :debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ãƒƒã‚¯
(defun canvas-debug-hook (thread level condition restarts frames conts)
  "SLDBã®ãƒ–ãƒ¬ãƒ¼ã‚¯æ™‚ã«Canvasã«é€šçŸ¥"
  (when *canvas-step-mode*
    (let ((current-function (extract-function-from-frames frames)))
      (notify-canvas-step current-function condition))))
```

#### Step 3: ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | ã‚­ãƒ¼ | èª¬æ˜ |
|---------|------|------|
| `living-canvas-set-breakpoint` | `b` | é¸æŠãƒãƒ¼ãƒ‰ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®š |
| `living-canvas-clear-breakpoints` | `B` | å…¨ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè§£é™¤ |
| `living-canvas-step-into` | `n` | ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ (sldb-step) |
| `living-canvas-step-over` | `N` | ã‚¹ãƒ†ãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼ (sldb-next) |
| `living-canvas-step-out` | `o` | ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ (sldb-out) |
| `living-canvas-continue` | `c` | ç¶šè¡Œ (sldb-continue) |

#### Step 4: Canvas UIæ›´æ–°

```javascript
// ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚«ãƒ¼
window.setBreakpoint = function(nodeId, active) {
  const node = cy.$('#' + CSS.escape(nodeId));
  if (active) {
    node.addClass('breakpoint');
  } else {
    node.removeClass('breakpoint');
  }
};

// ç¾åœ¨ã®åœæ­¢ä½ç½®ã‚’è¡¨ç¤º
window.showStoppedAt = function(nodeId, condition, locals) {
  // ãƒãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  cy.nodes().removeClass('stopped');
  const node = cy.$('#' + CSS.escape(nodeId));
  node.addClass('stopped');

  // ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
  showLocalsPanel(locals);

  // ãƒãƒ¼ãƒ‰ã«ã‚ºãƒ¼ãƒ 
  cy.animate({ center: { eles: node }, zoom: 1.5, duration: 300 });
};
```

### CSS ã‚¹ã‚¿ã‚¤ãƒ«

```css
/* ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚«ãƒ¼ */
node.breakpoint {
  border-style: dashed;
  border-color: #ff4444;
}
node.breakpoint::before {
  content: 'â—';
  color: #ff4444;
}

/* åœæ­¢ä¸­ã®ãƒãƒ¼ãƒ‰ */
node.stopped {
  background-color: #ff8800;
  border-color: #ff4400;
  border-width: 4px;
  box-shadow: 0 0 20px rgba(255, 136, 0, 0.8);
}
```

### å®Ÿè£…é †åº

```
[1] ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®šUI
    â”œâ”€â”€ Canvasä¸Šã§ãƒãƒ¼ãƒ‰é¸æŠ â†’ bã‚­ãƒ¼ã§ãƒ–ãƒ¬ãƒ¼ã‚¯è¨­å®š
    â””â”€â”€ ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã®è¦–è¦šè¡¨ç¤ºï¼ˆèµ¤ã„ç‚¹ï¼‰

[2] :debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€£æº
    â”œâ”€â”€ sldb.lisp ã®ãƒ•ãƒƒã‚¯è¿½åŠ 
    â””â”€â”€ Canvasã¸ã®åœæ­¢é€šçŸ¥

[3] ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
    â”œâ”€â”€ step-into (n)
    â”œâ”€â”€ step-over (N)
    â”œâ”€â”€ step-out (o)
    â””â”€â”€ continue (c)

[4] ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°è¡¨ç¤º
    â”œâ”€â”€ framesæƒ…å ±ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°æŠ½å‡º
    â””â”€â”€ Canvasãƒ‘ãƒãƒ«ã«è¡¨ç¤º

[5] å‘¼ã³å‡ºã—ã‚¹ã‚¿ãƒƒã‚¯è¡¨ç¤º
    â”œâ”€â”€ ç¾åœ¨ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’Canvasä¸Šã«è¡¨ç¤º
    â””â”€â”€ ã‚¹ã‚¿ãƒƒã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ã®é¸æŠã§ã‚½ãƒ¼ã‚¹ã‚¸ãƒ£ãƒ³ãƒ—
```

### ä¾å­˜é–¢ä¿‚

- `lem-lisp-mode/sldb` - SLDBã¨ã®é€£æº
- `lem-lisp-mode/message-dispatcher` - :debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒƒã‚¯
- `micros:sldb-break`, `micros:sldb-step` ç­‰ã®API

### å®Ÿè£…çŠ¶æ…‹ (2025-12-14æ›´æ–°)

**å‰ææ¡ä»¶**: Phase 2 (trace.lisp) ã®å®Œäº†

- [ ] Step 1: ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®šUI
- [ ] Step 2: :debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒƒã‚¯ï¼ˆsldb-setupã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼‰
- [ ] Step 3: ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼ˆstep-into/over/out/continue/abortï¼‰
- [ ] Step 4: Canvas UIæ›´æ–°ï¼ˆCSS/JavaScriptï¼‰
- [ ] Step 5: ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ»åœæ­¢ä½ç½®è¡¨ç¤º

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `debugger.lisp` â¬š æœªä½œæˆ

---

## å°†æ¥ã®æ‹¡å¼µ

### Phase 3: AIçµ±åˆ

```lisp
;; ä»˜ç®‹ãƒ‡ãƒ¼ã‚¿
(defstruct sticky-note
  id              ; ãƒ¦ãƒ‹ãƒ¼ã‚¯ID
  node-id         ; é–¢é€£ã™ã‚‹ãƒãƒ¼ãƒ‰ID
  content         ; ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆ
  ai-response     ; AIç”Ÿæˆçµæœ
  status)         ; :pending, :generating, :ready, :applied
```

### Phase 4: æ™‚é–“è»¸

```lisp
;; ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
(defstruct graph-snapshot
  timestamp
  graph-data
  buffer-state
  description)
```

---

## å…¨ä½“ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

```
Phase 1 (åŸºç›¤) âœ… å®Œäº†
â”œâ”€â”€ é–¢æ•°æŠ½å‡º âœ…
â”œâ”€â”€ ã‚°ãƒ©ãƒ•æç”» âœ…
â”œâ”€â”€ ãƒãƒ¼ãƒ‰æ“ä½œ âœ…
â””â”€â”€ ã‚½ãƒ¼ã‚¹ã‚¸ãƒ£ãƒ³ãƒ— âœ…
        â”‚
        â–¼
Phase 1.5 (ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¢ç´¢) â† ã€å®Ÿè£…ä¸­ã€‘
â”œâ”€â”€ ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ« âœ…
â”œâ”€â”€ ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ âœ…
â”œâ”€â”€ ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºå‹•çš„èª¿æ•´
â”œâ”€â”€ ã‚¨ãƒƒã‚¸è‰²åˆ†ã‘
â”œâ”€â”€ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°UI
â”œâ”€â”€ ãƒ‘ã‚¹æ¤œç´¢
â””â”€â”€ å¾ªç’°ä¾å­˜æ¤œå‡º
        â”‚
        â–¼
Phase 1.7 (ã‚³ãƒ¼ãƒ‰é€£æºå¼·åŒ–)
â”œâ”€â”€ ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆè¡¨ç¤º
â”œâ”€â”€ ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®åŒæœŸ
â””â”€â”€ Split view
        â”‚
        â–¼
Phase 2 (å®Ÿè¡Œå¯è¦–åŒ–ãƒ»ç°¡æ˜“ç‰ˆ)
â”œâ”€â”€ åŸºæœ¬traceå¯è¦–åŒ–
â””â”€â”€ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
        â”‚
        â–¼
Phase 3 (AIçµ±åˆ)
â”œâ”€â”€ ä»˜ç®‹ã‚·ã‚¹ãƒ†ãƒ 
â””â”€â”€ AIèª¬æ˜ç”Ÿæˆ
        â”‚
        â–¼
    â˜… ã‚³ãƒ¼ãƒ‰ç†è§£æ”¯æ´ãƒ„ãƒ¼ãƒ«ã®å®Œæˆ â˜…
        â”‚
        â–¼
Phase 2.5/4 (å»¶æœŸ)
â”œâ”€â”€ SLDBçµ±åˆ (åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¤œè¨)
â””â”€â”€ æ™‚é–“è»¸ç·¨é›† (ç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒ–æ¤œè¨)
```

---

## ãƒªã‚¹ã‚¯ã¨æŠ€è¡“çš„èª²é¡Œ

### æŠ€è¡“çš„ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | ç™ºç”Ÿç¢ºç‡ | å½±éŸ¿åº¦ | å¯¾ç­– |
|--------|----------|--------|------|
| å¤§è¦æ¨¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ | é«˜ | é«˜ | ãƒãƒ¼ãƒ‰æ•°åˆ¶é™ã€é…å»¶èª­ã¿è¾¼ã¿ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° |
| sb-introspectä¾å­˜ï¼ˆSBCLå°‚ç”¨ï¼‰ | ä¸­ | é«˜ | ä»–å‡¦ç†ç³»ã§ã®ä»£æ›¿æ‰‹æ®µèª¿æŸ»ã€graceful degradation |
| WebView/Cytoscape.jsã®ãƒ¡ãƒ¢ãƒªæ¶ˆè²» | ä¸­ | ä¸­ | ä»®æƒ³åŒ–ã€è¡¨ç¤ºç¯„å›²ã®åˆ¶é™ |

### UXä¸Šã®èª²é¡Œ

| èª²é¡Œ | ç¾åœ¨ã®çŠ¶æ…‹ | æ”¹å–„æ¡ˆ |
|------|-----------|--------|
| ã‚°ãƒ©ãƒ•ãŒè¤‡é›‘ã™ãã¦å…¨ä½“åƒãŒæŠŠæ¡ã§ããªã„ | ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚ã‚Š | éšå±¤çš„ã‚ºãƒ¼ãƒ ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚ºãƒ¼ãƒ å°å…¥ |
| ã€Œä½•ã‚’ã™ã‚Œã°ã„ã„ã‹ã€ãŒã‚ã‹ã‚‰ãªã„ | æ“ä½œèª¬æ˜ãªã— | ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ„ã‚¢ãƒ¼ã€ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ« |
| ã‚°ãƒ©ãƒ•ã¨ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆ‡ã‚Šæ›¿ãˆãŒæ‰‹é–“ | åˆ¥ãƒãƒƒãƒ•ã‚¡ã§è¡¨ç¤º | Split viewã€ã¾ãŸã¯åŒæœŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« |

### ã‚¹ã‚³ãƒ¼ãƒ—ã‚¯ãƒªãƒ¼ãƒ—ã®ãƒªã‚¹ã‚¯

| æ©Ÿèƒ½æ¡ˆ | ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ« | ç†ç”± |
|--------|-------------|------|
| Phase 2.5ï¼ˆSLDBçµ±åˆï¼‰ | é«˜ | ãƒ‡ãƒãƒƒã‚¬çµ±åˆã¯åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ |
| Phase 4ï¼ˆæ™‚é–“è»¸ç·¨é›†ï¼‰ | éå¸¸ã«é«˜ | ç ”ç©¶ãƒ¬ãƒ™ãƒ«ã®æ©Ÿèƒ½ã€å®Ÿç”¨æ€§æœªæ¤œè¨¼ |
| ãƒãƒ«ãƒè¨€èªå¯¾å¿œ | é«˜ | å„è¨€èªã®ASTè§£æãŒå¿…è¦ |

---

## ä½œæˆæ—¥

2025-12-13

## æ›´æ–°å±¥æ­´

- 2025-12-14: Phase 1.5 å®Ÿè£…é€²æ—
  - ãƒãƒ¼ãƒ‰è©³ç´°ãƒ‘ãƒãƒ«å®Ÿè£…å®Œäº†ï¼ˆarglistã€source locationã€æ¥ç¶šæ•°è¡¨ç¤ºï¼‰
  - ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½å®Ÿè£…å®Œäº†ï¼ˆpop-to-bufferã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒã‚¤ãƒ©ã‚¤ãƒˆã€è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰
- 2025-12-14: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›®çš„ã®æ˜ç¢ºåŒ–ã€Phase 1.5/1.7 è¿½åŠ ã€å„ªå…ˆé †ä½ã®å†æ¤œè¨

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [LIVING-CANVAS-PHASE2-PLAN.md](./LIVING-CANVAS-PHASE2-PLAN.md) - Phase 2 å®Ÿè£…è¨ˆç”»
- [ARCHITECTURE.md](./ARCHITECTURE.md) - Lemã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [extension-development.md](./extension-development.md) - æ‹¡å¼µé–‹ç™ºã‚¬ã‚¤ãƒ‰
